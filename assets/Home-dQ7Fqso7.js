import{r as h,j as t,a as T,H as v,L as b}from"./index-BxYHan_h.js";import{T as d,p as k,g as S}from"./tasks.service-BGByFu7T.js";const N={width:0,height:0,halfWidth:0,halfHeight:0};function x(i){const{data:o}=i,r=h.useRef(null),[a,u]=h.useState(N),[g,s]=h.useState(""),c=n=>{n.dataTransfer.setData("text/plain",o.id),n.dataTransfer.effectAllowed="move",setTimeout(()=>{var l;(l=r.current)==null||l.classList.add("hide")},0)},f=n=>{n.preventDefault(),n.stopPropagation();const l=n.nativeEvent.offsetX,p=n.nativeEvent.offsetY,j=18,H=(l-a.halfWidth)/a.halfWidth*j,L=(p-a.halfHeight)/a.halfHeight*j;s(`rotateX(${H}deg) rotateY(${L}deg)`)},e=()=>{s("")},m=n=>{var l;(l=r.current)==null||l.classList.remove("hide")};return h.useEffect(()=>{const{width:n,height:l}=r.current.getBoundingClientRect();u({width:n,height:l,halfWidth:n/2,halfHeight:l/2})},[]),t.jsxs("div",{id:o.id,className:"card-container",onDragStart:c,onDragEnd:m,draggable:!0,onMouseMove:f,onMouseLeave:e,ref:r,style:{transform:g},children:[t.jsx("div",{className:"card-title",children:t.jsx("h2",{children:o.title})}),t.jsx("div",{className:"card-body",children:t.jsx("p",{children:o.body})}),t.jsx("div",{className:"card-footer",children:t.jsxs("p",{children:[o.author," - ",o.createdAt.slice(0,10)]})})]})}function D(i){const{id:o,title:r,color:a,children:u}=i;return t.jsxs("div",{id:o,style:{backgroundColor:a},className:"column-container",children:[t.jsx("div",{className:"column-title",children:r}),t.jsx("div",{className:"column-body",children:u})]})}function C(i){const o=T(e=>e.auth.authData),{kanbanTasks:r}=i,[a,u]=h.useState(null),g="droppable",s=e=>{e.preventDefault(),e.dataTransfer&&e.dataTransfer.types[0]==="text/plain"&&a!==+e.currentTarget.id.replace("column-","")&&(console.log(e),u(+e.currentTarget.id.replace("column-","")),console.log("DRAGOVERHANDLER....."))},c=e=>{e.preventDefault();const m=e.dataTransfer.getData("text/plain"),n=r.filter(p=>p.id==m);if(n[0].status===a){u(null);return}console.log("dropHandler:"),console.log(`dropped: task with id: ${m} in ${e.currentTarget.id}`),console.log(e),console.log("..........");const l=o.token;console.log({patchedTask:n}),n[0].status=a??0,k(n[0],l),u(null)},f=e=>{e.preventDefault(),console.log("DragLeave")};return t.jsxs("div",{className:"kanban-container",children:[t.jsx(D,{id:"x0",title:"To Do",color:"#FDC974",children:t.jsx("div",{id:`column-${d.todo}`,className:`column-item todo-container ${a===d.todo?g:""}`,onDragOver:s,onDrop:c,onDragLeave:f,children:r.map(e=>{if(e.status===d.todo)return t.jsx(x,{data:e},e.id)})})}),t.jsx(D,{id:"x1",title:"Doing",color:"#f98468",children:t.jsx("div",{id:`column-${d.doing}`,className:`column-item todo-container ${a===d.doing?g:""}`,onDragOver:s,onDrop:c,onDragLeave:f,children:r.map(e=>{if(e.status===d.doing)return t.jsx(x,{data:e},e.id)})})}),t.jsx(D,{id:"x3",title:"Done",color:"#fa3463",children:t.jsx("div",{id:`column-${d.done}`,className:`column-item todo-container ${a===d.done?g:""}`,onDragOver:s,onDrop:c,onDragLeave:f,children:r.map(e=>{if(e.status===d.done)return t.jsx(x,{data:e},e.id)})})}),a!==null&&t.jsx("div",{className:`trash-container ${a===d.deleted?g:""}`,id:`column-${d.deleted}`,onDragOver:s,onDrop:c,onDragLeave:f})]})}function $(){const i=T(s=>s.auth.authData),[o,r]=h.useState([]),[a,u]=h.useState(!0),g=async s=>{const c=await S(i.token,s);console.log("useTasks()"),console.log(c),r(c),u(!1)};return h.useEffect(()=>{const s=new AbortController,c=s.signal;return g(c),()=>{console.log("Cancelling request..."),s.abort()}},[]),[o,a]}function y(){console.log("rendering Home...");const[i,o]=$();return t.jsxs(t.Fragment,{children:[t.jsx(v,{children:t.jsx("title",{children:"Kanban App - Home"})}),o?t.jsxs(t.Fragment,{children:[t.jsx(v,{children:t.jsx("title",{children:"Kanban App - Loading..."})}),t.jsx(b,{})]}):t.jsx("div",{children:t.jsx(C,{kanbanTasks:i})})]})}export{y as default};
